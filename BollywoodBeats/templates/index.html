<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bollywood Beats</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
</head>
<body>

  {% include 'partials/nav.html' %}

  <div class="container mt-3">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <section class="bg-warning text-dark text-center py-5">
    <div class="container">
      <h1 class="display-4 fw-bold">Welcome to Bollywood Beats</h1>
      <p class="lead">Discover and book unforgettable music experiences across Australia.</p>
      {% if not current_user.is_authenticated %}
        <div class="mt-4 d-flex justify-content-center gap-3 flex-wrap">
          <a href="{{ url_for('auth.login') }}" class="btn"
             style="background-color:#ef902f;color:#fff;font-weight:700;border:none;padding:0.85rem 2.5rem;border-radius:0.75rem;">Login</a>
          <a href="{{ url_for('auth.register') }}" class="btn"
             style="background-color:#ef902f;color:#fff;font-weight:700;border:none;padding:0.85rem 2.5rem;border-radius:0.75rem;">Register</a>
        </div>
      {% endif %}
    </div>
  </section>

  <section class="py-5" id="events">
    <div class="container">
      <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4 gap-3">
        <div>
          <h2 class="mb-1">Upcoming Events</h2>
          {% if search_term %}
            <p class="text-muted mb-0">Showing results for "<strong>{{ search_term }}</strong>"</p>
          {% else %}
            <p class="text-muted mb-0">Filter by category or search for the perfect night out.</p>
          {% endif %}
        </div>
        <form method="get" class="row g-2 align-items-center flex-grow-1 flex-lg-grow-0">
          <label for="category" class="visually-hidden">Filter by category</label>
          <div class="col-12 col-sm-auto">
            <select name="category" id="category" class="form-select">
              {% for category in categories %}
                <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>{{ category }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-12 col-sm-auto">
            <input type="search" class="form-control" name="q" placeholder="Search events"
                   value="{{ search_term }}">
          </div>
          <div class="col-12 col-sm-auto d-grid d-sm-block">
            <button type="submit" class="btn btn-dark w-100">Apply</button>
          </div>
        </form>
      </div>

      {% if events %}
        <div class="row g-4">
          {% for event in events %}
            <div class="col-md-4">
              <div class="card h-100 shadow-sm">
                {% if event.image_url %}
                  {% if event.image_url.startswith('http') %}
                    <img src="{{ event.image_url }}" class="card-img-top" alt="{{ event.title }}">
                  {% else %}
                    <img src="{{ url_for('static', filename=event.image_url) }}" class="card-img-top" alt="{{ event.title }}">
                  {% endif %}
                {% else %}
                  <img src="{{ url_for('static', filename='concert7.jpg') }}" class="card-img-top" alt="Concert image">
                {% endif %}
                <div class="card-body d-flex flex-column">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="card-title mb-0">{{ event.title }}</h5>
                    <span class="badge bg-warning text-dark">{{ event.category }}</span>
                  </div>
                  <div class="mb-2">
                    {% set status_name = event.status.name if event.status else 'OPEN' %}
                    {% set status_value = event.status.value if event.status else 'Open' %}
                    {% if status_name == 'OPEN' %}
                      {% set badge_class = 'bg-success' %}
                    {% elif status_name == 'SOLD_OUT' %}
                      {% set badge_class = 'bg-secondary' %}
                    {% elif status_name == 'CANCELLED' %}
                      {% set badge_class = 'bg-danger' %}
                    {% else %}
                      {% set badge_class = 'bg-warning text-dark' %}
                    {% endif %}
                    <span class="badge {{ badge_class }}">{{ status_value }}</span>
                  </div>
                  <p class="card-text text-muted mb-2">
                    {{ event.city }}, {{ event.venue }}
                  </p>
                  <p class="card-text mb-3">
                    {{ event.start_dt.strftime('%d %B %Y %I:%M %p') if event.start_dt else 'Date TBA' }}
                  </p>
                  <p class="card-text fw-semibold mb-4">
                    ${{ '{:,.2f}'.format(event.lowest_ticket_price or 0) }}
                  </p>
                  <a href="{{ url_for('main.event_details', event_id=event.id) }}" class="btn btn-warning mt-auto">View Details</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-5">
          <h5 class="fw-bold">No events found</h5>
          <p class="text-muted">Create a new event or adjust the category filter.</p>
          <a href="{{ url_for('main.create_event') }}" class="btn btn-warning">Create Event</a>
        </div>
      {% endif %}
    </div>
  </section>

  <footer class="bg-dark text-white text-center py-4">
    <div class="mb-3">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Bollywood Beats Logo" height="50">
    </div>
    <p class="mb-0">&copy; 2025 Bollywood Beats</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
